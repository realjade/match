/**
 * plupload.js
 *
 * Copyright 2009, Moxiecode Systems AB
 * Released under GPL License.
 *
 * License: http://www.plupload.com/license
 * Contributing: http://www.plupload.com/contributing
 */// JSLint defined globals
/*global window:false, escape:false *//*!@@version@@*/(function(){function k(){this.returnValue=!1}function l(){this.cancelBubble=!0}var a=0,b=[],c={},d={},e={"<":"lt",">":"gt","&":"amp",'"':"quot","'":"#39"},f=/[<>&\"\']/g,g,h=window.setTimeout,i={},j;(function(a){var b=a.split(/,/),c,e,f;for(c=0;c<b.length;c+=2){f=b[c+1].split(/ /);for(e=0;e<f.length;e++)d[f[e]]=b[c]}})("application/msword,doc dot,application/pdf,pdf,application/pgp-signature,pgp,application/postscript,ps ai eps,application/rtf,rtf,application/vnd.ms-excel,xls xlb,application/vnd.ms-powerpoint,ppt pps pot,application/zip,zip,application/x-shockwave-flash,swf swfl,application/vnd.openxmlformats-officedocument.wordprocessingml.document,docx,application/vnd.openxmlformats-officedocument.wordprocessingml.template,dotx,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,xlsx,application/vnd.openxmlformats-officedocument.presentationml.presentation,pptx,application/vnd.openxmlformats-officedocument.presentationml.template,potx,application/vnd.openxmlformats-officedocument.presentationml.slideshow,ppsx,application/x-javascript,js,application/json,json,audio/mpeg,mpga mpega mp2 mp3,audio/x-wav,wav,audio/mp4,m4a,image/bmp,bmp,image/gif,gif,image/jpeg,jpeg jpg jpe,image/photoshop,psd,image/png,png,image/svg+xml,svg svgz,image/tiff,tiff tif,text/plain,asc txt text diff log,text/html,htm html xhtml,text/css,css,text/csv,csv,text/rtf,rtf,video/mpeg,mpeg mpg mpe,video/quicktime,qt mov,video/mp4,mp4,video/x-m4v,m4v,video/x-flv,flv,video/x-ms-wmv,wmv,video/avi,avi,video/webm,webm,video/vnd.rn-realvideo,rv,application/vnd.oasis.opendocument.formula-template,otf,application/octet-stream,exe");var m={VERSION:"@@version@@",STOPPED:1,STARTED:2,QUEUED:1,UPLOADING:2,FAILED:4,DONE:5,GENERIC_ERROR:-100,HTTP_ERROR:-200,IO_ERROR:-300,SECURITY_ERROR:-400,INIT_ERROR:-500,FILE_SIZE_ERROR:-600,FILE_EXTENSION_ERROR:-601,IMAGE_FORMAT_ERROR:-700,IMAGE_MEMORY_ERROR:-701,IMAGE_DIMENSIONS_ERROR:-702,mimeTypes:d,ua:function(){var a=navigator,b=a.userAgent,c=a.vendor,d,e,f;return d=/WebKit/.test(b),f=d&&c.indexOf("Apple")!==-1,e=window.opera&&window.opera.buildNumber,{windows:navigator.platform.indexOf("Win")!==-1,ie:!d&&!e&&/MSIE/gi.test(b)&&/Explorer/gi.test(a.appName),webkit:d,gecko:!d&&/Gecko/.test(b),safari:f,opera:!!e}}(),typeOf:function(a){return{}.toString.call(a).match(/\s([a-z|A-Z]+)/)[1].toLowerCase()},extend:function(a){return m.each(arguments,function(b,c){c>0&&m.each(b,function(b,c){a[c]=b})}),a},cleanName:function(a){var b,c;c=[/[\300-\306]/g,"A",/[\340-\346]/g,"a",/\307/g,"C",/\347/g,"c",/[\310-\313]/g,"E",/[\350-\353]/g,"e",/[\314-\317]/g,"I",/[\354-\357]/g,"i",/\321/g,"N",/\361/g,"n",/[\322-\330]/g,"O",/[\362-\370]/g,"o",/[\331-\334]/g,"U",/[\371-\374]/g,"u"];for(b=0;b<c.length;b+=2)a=a.replace(c[b],c[b+1]);return a=a.replace(/\s+/g,"_"),a=a.replace(/[^a-z0-9_\-\.]+/gi,""),a},addRuntime:function(a,c){return c.name=a,b[a]=c,b.push(c),c},guid:function(){var b=(new Date).getTime().toString(32),c;for(c=0;c<5;c++)b+=Math.floor(Math.random()*65535).toString(32);return(m.guidPrefix||"p")+b+(a++).toString(32)},buildUrl:function(a,b){var c="";return m.each(b,function(a,b){c+=(c?"&":"")+encodeURIComponent(b)+"="+encodeURIComponent(a)}),c&&(a+=(a.indexOf("?")>0?"&":"?")+c),a},each:function(a,b){var c,d,e;if(a){c=a.length;if(c===g){for(d in a)if(a.hasOwnProperty(d)&&b(a[d],d)===!1)return}else for(e=0;e<c;e++)if(b(a[e],e)===!1)return}},formatSize:function(a){return a===g||/\D/.test(a)?m.translate("N/A"):a>1073741824?Math.round(a/1073741824,1)+" GB":a>1048576?Math.round(a/1048576,1)+" MB":a>1024?Math.round(a/1024,1)+" KB":a+" b"},getPos:function(a,b){function i(a){var b,c,d=0,e=0;return a&&(c=a.getBoundingClientRect(),b=f.compatMode==="CSS1Compat"?f.documentElement:f.body,d=c.left+b.scrollLeft,e=c.top+b.scrollTop),{x:d,y:e}}var c=0,d=0,e,f=document,g,h;a=a,b=b||f.body;if(a&&a.getBoundingClientRect&&navigator.userAgent.indexOf("MSIE")>0&&f.documentMode<8)return g=i(a),h=i(b),{x:g.x-h.x,y:g.y-h.y};e=a;while(e&&e!=b&&e.nodeType)c+=e.offsetLeft||0,d+=e.offsetTop||0,e=e.offsetParent;e=a.parentNode;while(e&&e!=b&&e.nodeType)c-=e.scrollLeft||0,d-=e.scrollTop||0,e=e.parentNode;return{x:c,y:d}},getSize:function(a){return{w:a.offsetWidth||a.clientWidth,h:a.offsetHeight||a.clientHeight}},parseSize:function(a){var b;return typeof a=="string"&&(a=/^([0-9]+)([mgk]?)$/.exec(a.toLowerCase().replace(/[^0-9mkg]/g,"")),b=a[2],a=+a[1],b=="g"&&(a*=1073741824),b=="m"&&(a*=1048576),b=="k"&&(a*=1024)),a},xmlEncode:function(a){return a?(""+a).replace(f,function(a){return e[a]?"&"+e[a]+";":a}):a},toArray:function(a){var b,c=[];for(b=0;b<a.length;b++)c[b]=a[b];return c},inArray:function(a,b){if(b){if(Array.prototype.indexOf)return Array.prototype.indexOf.call(b,a);for(var c=0,d=b.length;c<d;c++)if(b[c]===a)return c}return-1},addI18n:function(a){return m.extend(c,a)},translate:function(a){return c[a]||a},isEmptyObj:function(a){if(a===g)return!0;for(var b in a)return!1;return!0},hasClass:function(a,b){var c;return a.className==""?!1:(c=new RegExp("(^|\\s+)"+b+"(\\s+|$)"),c.test(a.className))},addClass:function(a,b){m.hasClass(a,b)||(a.className=a.className==""?b:a.className.replace(/\s+$/,"")+" "+b)},removeClass:function(a,b){var c=new RegExp("(^|\\s+)"+b+"(\\s+|$)");a.className=a.className.replace(c,function(a,b,c){return b===" "&&c===" "?" ":""})},getStyle:function(a,b){if(a.currentStyle)return a.currentStyle[b];if(window.getComputedStyle)return window.getComputedStyle(a,null)[b]},addEvent:function(a,b,c){var d,e,f,h;h=arguments[3],b=b.toLowerCase(),j===g&&(j="Plupload_"+m.guid()),a.addEventListener?(d=c,a.addEventListener(b,d,!1)):a.attachEvent&&(d=function(){var a=window.event;a.target||(a.target=a.srcElement),a.preventDefault=k,a.stopPropagation=l,c(a)},a.attachEvent("on"+b,d)),a[j]===g&&(a[j]=m.guid()),i.hasOwnProperty(a[j])||(i[a[j]]={}),e=i[a[j]],e.hasOwnProperty(b)||(e[b]=[]),e[b].push({func:d,orig:c,key:h})},removeEvent:function(a,b){var c,d,e;typeof arguments[2]=="function"?d=arguments[2]:e=arguments[2],b=b.toLowerCase();if(a[j]&&i[a[j]]&&i[a[j]][b])c=i[a[j]][b];else return;for(var f=c.length-1;f>=0;f--)if(c[f].key===e||c[f].orig===d){a.removeEventListener?a.removeEventListener(b,c[f].func,!1):a.detachEvent&&a.detachEvent("on"+b,c[f].func),c[f].orig=null,c[f].func=null,c.splice(f,1);if(d!==g)break}c.length||delete i[a[j]][b];if(m.isEmptyObj(i[a[j]])){delete i[a[j]];try{delete a[j]}catch(h){a[j]=g}}},removeAllEvents:function(a){var b=arguments[1];if(a[j]===g||!a[j])return;m.each(i[a[j]],function(c,d){m.removeEvent(a,d,b)})}};m.Uploader=function(a){function j(){var a,b=0,c;if(this.state==m.STARTED){for(c=0;c<e.length;c++)!a&&e[c].status==m.QUEUED?(a=e[c],a.status=m.UPLOADING,this.trigger("BeforeUpload",a)&&this.trigger("UploadFile",a)):b++;b==e.length&&(this.stop(),this.trigger("UploadComplete",e))}}function k(){var a,b;d.reset();for(a=0;a<e.length;a++)b=e[a],b.size!==g?(d.size+=b.size,d.loaded+=b.loaded):d.size=g,b.status==m.DONE?d.uploaded++:b.status==m.FAILED?d.failed++:d.queued++;d.size===g?d.percent=e.length>0?Math.ceil(d.uploaded/e.length*100):0:(d.bytesPerSec=Math.ceil(d.loaded/((+(new Date)-f||1)/1e3)),d.percent=d.size>0?Math.ceil(d.loaded/d.size*100):0)}var c={},d,e=[],f,i=!1;d=new m.QueueProgress,a=m.extend({chunk_size:0,multipart:!0,multi_selection:!0,file_data_name:"file",filters:[]},a),m.extend(this,{state:m.STOPPED,runtime:"",features:{},files:e,settings:a,total:d,id:m.guid(),init:function(){function p(){var a=i[n++],b,d,e;if(a){b=a.getFeatures(),d=c.settings.required_features;if(d){d=d.split(",");for(e=0;e<d.length;e++)if(!b[d[e]]){p();return}}a.init(c,function(d){d&&d.success?(c.features=b,c.runtime=a.name,c.trigger("Init",{runtime:a.name}),c.trigger("PostInit"),c.refresh()):p()})}else c.trigger("Error",{code:m.INIT_ERROR,message:m.translate("Init error.")})}var c=this,d,i,l,n=0,o;typeof a.preinit=="function"?a.preinit(c):m.each(a.preinit,function(a,b){c.bind(b,a)}),a.page_url=a.page_url||document.location.pathname.replace(/\/[^\/]+$/g,"/"),/^(\w+:\/\/|\/)/.test(a.url)||(a.url=a.page_url+a.url),a.chunk_size=m.parseSize(a.chunk_size),a.max_file_size=m.parseSize(a.max_file_size),c.bind("FilesAdded",function(b,d){var f,i,j=0,k,l=a.filters;l&&l.length&&(k=[],m.each(l,function(a){m.each(a.extensions.split(/,/),function(a){/^\s*\*\s*$/.test(a)?k.push("\\.*"):k.push("\\."+a.replace(new RegExp("["+"/^$.*+?|()[]{}\\".replace(/./g,"\\$&")+"]","g"),"\\$&"))})}),k=new RegExp(k.join("|")+"$","i"));for(f=0;f<d.length;f++){i=d[f],i.loaded=0,i.percent=0,i.status=m.QUEUED;if(k&&!k.test(i.name)){b.trigger("Error",{code:m.FILE_EXTENSION_ERROR,message:m.translate("File extension error."),file:i});continue}if(i.size!==g&&i.size>a.max_file_size){b.trigger("Error",{code:m.FILE_SIZE_ERROR,message:m.translate("File size error."),file:i});continue}e.push(i),j++}if(j)h(function(){c.trigger("QueueChanged"),c.refresh()},1);else return!1}),a.unique_names&&c.bind("UploadFile",function(a,b){var c=b.name.match(/\.([^.]+)$/),d="tmp";c&&(d=c[1]),b.target_name=b.id+"."+d}),c.bind("UploadProgress",function(a,b){b.percent=b.size>0?Math.ceil(b.loaded/b.size*100):100,k()}),c.bind("StateChanged",function(a){if(a.state==m.STARTED)f=+(new Date);else if(a.state==m.STOPPED)for(d=a.files.length-1;d>=0;d--)a.files[d].status==m.UPLOADING&&(a.files[d].status=m.QUEUED,k())}),c.bind("QueueChanged",k),c.bind("Error",function(a,b){b.file&&(b.file.status=m.FAILED,k(),a.state==m.STARTED&&h(function(){j.call(c)},1))}),c.bind("FileUploaded",function(a,b){b.status=m.DONE,b.loaded=b.size,a.trigger("UploadProgress",b),h(function(){j.call(c)},1)});if(a.runtimes){i=[],o=a.runtimes.split(/\s?,\s?/);for(d=0;d<o.length;d++)b[o[d]]&&i.push(b[o[d]])}else i=b;p(),typeof a.init=="function"?a.init(c):m.each(a.init,function(a,b){c.bind(b,a)})},refresh:function(){this.trigger("Refresh")},start:function(){e.length&&this.state!=m.STARTED&&(this.state=m.STARTED,this.trigger("StateChanged"),j.call(this))},stop:function(){this.state!=m.STOPPED&&(this.state=m.STOPPED,this.trigger("CancelUpload"),this.trigger("StateChanged"))},disableBrowse:function(){i=arguments[0]!==g?arguments[0]:!0,this.trigger("DisableBrowse",i)},getFile:function(a){var b;for(b=e.length-1;b>=0;b--)if(e[b].id===a)return e[b]},removeFile:function(a){var b;for(b=e.length-1;b>=0;b--)if(e[b].id===a.id)return this.splice(b,1)[0]},splice:function(a,b){var c;return c=e.splice(a===g?0:a,b===g?e.length:b),this.trigger("FilesRemoved",c),this.trigger("QueueChanged"),c},trigger:function(a){var b=c[a.toLowerCase()],d,e;if(b){e=Array.prototype.slice.call(arguments),e[0]=this;for(d=0;d<b.length;d++)if(b[d].func.apply(b[d].scope,e)===!1)return!1}return!0},hasEventListener:function(a){return!!c[a.toLowerCase()]},bind:function(a,b,d){var e;a=a.toLowerCase(),e=c[a]||[],e.push({func:b,scope:d||this}),c[a]=e},unbind:function(a){a=a.toLowerCase();var b=c[a],d,e=arguments[1];if(b){if(e!==g){for(d=b.length-1;d>=0;d--)if(b[d].func===e){b.splice(d,1);break}}else b=[];b.length||delete c[a]}},unbindAll:function(){var a=this;m.each(c,function(b,c){a.unbind(c)})},destroy:function(){this.stop(),this.trigger("Destroy"),this.unbindAll()}})},m.File=function(a,b,c){var d=this;d.id=a,d.name=b,d.size=c,d.loaded=0,d.percent=0,d.status=0},m.Runtime=function(){this.getFeatures=function(){},this.init=function(a,b){}},m.QueueProgress=function(){var a=this;a.size=0,a.loaded=0,a.uploaded=0,a.failed=0,a.queued=0,a.percent=0,a.bytesPerSec=0,a.reset=function(){a.size=a.loaded=a.uploaded=a.failed=a.queued=a.percent=a.bytesPerSec=0}},m.runtimes={},window.plupload=m})(),function(a,b,c,d){function g(){var a;try{a=navigator.plugins["Shockwave Flash"],a=a.description}catch(b){try{a=(new ActiveXObject("ShockwaveFlash.ShockwaveFlash")).GetVariable("$version")}catch(c){a="0.0"}}return a=a.match(/\d+/g),parseFloat(a[0]+"."+a[1])}var e={},f={};c.flash={trigger:function(a,b,c){setTimeout(function(){var d=e[a],f,g;d&&d.trigger("Flash:"+b,c)},0)}},c.runtimes.Flash=c.addRuntime("flash",{getFeatures:function(){return{jpgresize:!0,pngresize:!0,maxWidth:8091,maxHeight:8091,chunks:!0,progress:!0,multipart:!0,multi_selection:!0}},init:function(a,d){function l(){return b.getElementById(a.id+"_flash")}function m(){if(j++>5e3){d({success:!1});return}f[a.id]===!1&&setTimeout(m,1)}var h,i,j=0,k=b.body;if(g()<10){d({success:!1});return}f[a.id]=!1,e[a.id]=a,h=b.getElementById(a.settings.browse_button),i=b.createElement("div"),i.id=a.id+"_flash_container",c.extend(i.style,{position:"absolute",top:"0px",background:a.settings.shim_bgcolor||"transparent",zIndex:99999,width:"100%",height:"100%"}),i.className="plupload flash",a.settings.container&&(k=b.getElementById(a.settings.container),c.getStyle(k,"position")==="static"&&(k.style.position="relative")),k.appendChild(i),function(){var d,e;d='<object id="'+a.id+'_flash" type="application/x-shockwave-flash" data="'+a.settings.flash_swf_url+'" ',c.ua.ie&&(d+='classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" '),d+='width="100%" height="100%" style="outline:0"><param name="movie" value="'+a.settings.flash_swf_url+'" />'+'<param name="flashvars" value="id='+escape(a.id)+'" />'+'<param name="wmode" value="transparent" />'+'<param name="allowscriptaccess" value="always" />'+"</object>",c.ua.ie?(e=b.createElement("div"),i.appendChild(e),e.outerHTML=d,e=null):i.innerHTML=d}(),m(),h=i=null,a.bind("Destroy",function(a){var d;c.removeAllEvents(b.body,a.id),delete f[a.id],delete e[a.id],d=b.getElementById(a.id+"_flash_container"),d&&k.removeChild(d)}),a.bind("Flash:Init",function(){var e={},g;try{l().setFileFilters(a.settings.filters,a.settings.multi_selection)}catch(h){d({success:!1});return}if(f[a.id])return;f[a.id]=!0,a.bind("UploadFile",function(b,d){var f=b.settings,g=a.settings.resize||{};l().uploadFile(e[d.id],f.url,{name:d.target_name||d.name,mime:c.mimeTypes[d.name.replace(/^.+\.([^.]+)/,"$1").toLowerCase()]||"application/octet-stream",chunk_size:f.chunk_size,width:g.width,height:g.height,quality:g.quality,multipart:f.multipart,multipart_params:f.multipart_params||{},file_data_name:f.file_data_name,format:/\.(jpg|jpeg)$/i.test(d.name)?"jpg":"png",headers:f.headers,urlstream_upload:f.urlstream_upload})}),a.bind("CancelUpload",function(){l().cancelUpload()}),a.bind("Flash:UploadProcess",function(a,b){var d=a.getFile(e[b.id]);d.status!=c.FAILED&&(d.loaded=b.loaded,d.size=b.size,a.trigger("UploadProgress",d))}),a.bind("Flash:UploadChunkComplete",function(a,b){var d,f=a.getFile(e[b.id]);d={chunk:b.chunk,chunks:b.chunks,response:b.text},a.trigger("ChunkUploaded",f,d),f.status!==c.FAILED&&a.state!==c.STOPPED&&l().uploadNextChunk(),b.chunk==b.chunks-1&&(f.status=c.DONE,a.trigger("FileUploaded",f,{response:b.text}))}),a.bind("Flash:SelectFiles",function(b,d){var f,g,h=[],i;for(g=0;g<d.length;g++)f=d[g],i=c.guid(),e[i]=f.id,e[f.id]=i,h.push(new c.File(i,f.name,f.size));h.length&&a.trigger("FilesAdded",h)}),a.bind("Flash:SecurityError",function(b,d){a.trigger("Error",{code:c.SECURITY_ERROR,message:c.translate("Security error."),details:d.message,file:a.getFile(e[d.id])})}),a.bind("Flash:GenericError",function(b,d){a.trigger("Error",{code:c.GENERIC_ERROR,message:c.translate("Generic error."),details:d.message,file:a.getFile(e[d.id])})}),a.bind("Flash:IOError",function(b,d){a.trigger("Error",{code:c.IO_ERROR,message:c.translate("IO error."),details:d.message,file:a.getFile(e[d.id])})}),a.bind("Flash:ImageError",function(b,d){a.trigger("Error",{code:parseInt(d.code,10),message:c.translate("Image error."),file:a.getFile(e[d.id])})}),a.bind("Flash:StageEvent:rollOver",function(d){var e,f;e=b.getElementById(a.settings.browse_button),f=d.settings.browse_button_hover,e&&f&&c.addClass(e,f)}),a.bind("Flash:StageEvent:rollOut",function(d){var e,f;e=b.getElementById(a.settings.browse_button),f=d.settings.browse_button_hover,e&&f&&c.removeClass(e,f)}),a.bind("Flash:StageEvent:mouseDown",function(d){var e,f;e=b.getElementById(a.settings.browse_button),f=d.settings.browse_button_active,e&&f&&(c.addClass(e,f),c.addEvent(b.body,"mouseup",function(){c.removeClass(e,f)},d.id))}),a.bind("Flash:StageEvent:mouseUp",function(d){var e,f;e=b.getElementById(a.settings.browse_button),f=d.settings.browse_button_active,e&&f&&c.removeClass(e,f)}),a.bind("Flash:ExifData",function(b,c){a.trigger("ExifData",a.getFile(e[c.id]),c.data)}),a.bind("Flash:GpsData",function(b,c){a.trigger("GpsData",a.getFile(e[c.id]),c.data)}),a.bind("QueueChanged",function(b){a.refresh()}),a.bind("FilesRemoved",function(a,b){var c;for(c=0;c<b.length;c++)l().removeFile(e[b[c].id])}),a.bind("StateChanged",function(b){a.refresh()}),a.bind("Refresh",function(d){var e,f,g;l().setFileFilters(a.settings.filters,a.settings.multi_selection),e=b.getElementById(d.settings.browse_button),e&&(f=c.getPos(e,b.getElementById(d.settings.container)),g=c.getSize(e),c.extend(b.getElementById(d.id+"_flash_container").style,{top:f.y+"px",left:f.x+"px",width:g.w+"px",height:g.h+"px"}))}),a.bind("DisableBrowse",function(a,b){l().disableBrowse(b)}),d({success:!0})})}})}(window,document,plupload),function(a,b,c,d){function g(b,c){var d;if("FileReader"in a)d=new FileReader,d.readAsDataURL(b),d.onload=function(){c(d.result)};else return c(b.getAsDataURL())}function h(b,c){var d;if("FileReader"in a)d=new FileReader,d.readAsBinaryString(b),d.onload=function(){c(d.result)};else return c(b.getAsBinary())}function j(a,c,d,f){var h,i,j,k,n=this;g(e[a.id],function(e){h=b.createElement("canvas"),h.style.display="none",b.body.appendChild(h),i=h.getContext("2d"),j=new Image,j.onerror=j.onabort=function(){f({success:!1})},j.onload=function(){var b,g,o,p,q;c.width||(c.width=j.width),c.height||(c.height=j.height),k=Math.min(c.width/j.width,c.height/j.height);if(k<1||k===1&&d==="image/jpeg"){b=Math.round(j.width*k),g=Math.round(j.height*k),h.width=b,h.height=g,i.drawImage(j,0,0,b,g);if(d==="image/jpeg"){p=new l(atob(e.substring(e.indexOf("base64,")+7))),p.headers&&p.headers.length&&(q=new m,q.init(p.get("exif")[0])&&(q.setExif("PixelXDimension",b),q.setExif("PixelYDimension",g),p.set("exif",q.getBinary()),n.hasEventListener("ExifData")&&n.trigger("ExifData",a,q.EXIF()),n.hasEventListener("GpsData")&&n.trigger("GpsData",a,q.GPS())));if(c.quality)try{e=h.toDataURL(d,c.quality/100)}catch(r){e=h.toDataURL(d)}}else e=h.toDataURL(d);e=e.substring(e.indexOf("base64,")+7),e=atob(e),p&&p.headers&&p.headers.length&&(e=p.restore(e),p.purge()),h.parentNode.removeChild(h),f({success:!0,data:e})}else f({success:!1})},j.src=e})}function k(){function c(c,d){var e=a?0:-8*(d-1),f=0,g;for(g=0;g<d;g++)f|=b.charCodeAt(c+g)<<Math.abs(e+g*8);return f}function e(a,c,d){var d=arguments.length===3?d:b.length-c-1;b=b.substr(0,c)+a+b.substr(d+c)}function f(b,c,d){var f="",g=a?0:-8*(d-1),h;for(h=0;h<d;h++)f+=String.fromCharCode(c>>Math.abs(g+h*8)&255);e(f,b,d)}var a=!1,b;return{II:function(b){if(b===d)return a;a=b},init:function(c){a=!1,b=c},SEGMENT:function(a,c,d){switch(arguments.length){case 1:return b.substr(a,b.length-a-1);case 2:return b.substr(a,c);case 3:e(d,a,c);break;default:return b}},BYTE:function(a){return c(a,1)},SHORT:function(a){return c(a,2)},LONG:function(a,b){if(b===d)return c(a,4);f(a,b,4)},SLONG:function(a){var b=c(a,4);return b>2147483647?b-4294967296:b},STRING:function(a,b){var d="";for(b+=a;a<b;a++)d+=String.fromCharCode(c(a,1));return d}}}function l(a){var b={65505:{app:"EXIF",name:"APP1",signature:"Exif\0"},65506:{app:"ICC",name:"APP2",signature:"ICC_PROFILE\0"},65517:{app:"IPTC",name:"APP13",signature:"Photoshop 3.0\0"}},c=[],e,f,g=d,h=0,i;e=new k,e.init(a);if(e.SHORT(0)!==65496)return;f=2,i=Math.min(1048576,a.length);while(f<=i){g=e.SHORT(f);if(g>=65488&&g<=65495){f+=2;continue}if(g===65498||g===65497)break;h=e.SHORT(f+2)+2,b[g]&&e.STRING(f+4,b[g].signature.length)===b[g].signature&&c.push({hex:g,app:b[g].app.toUpperCase(),name:b[g].name.toUpperCase(),start:f,length:h,segment:e.SEGMENT(f,h)}),f+=h}return e.init(null),{headers:c,restore:function(a){e.init(a);var b=new l(a);if(!b.headers)return!1;for(var d=b.headers.length;d>0;d--){var g=b.headers[d-1];e.SEGMENT(g.start,g.length,"")}b.purge(),f=e.SHORT(2)==65504?4+e.SHORT(4):2;for(var d=0,h=c.length;d<h;d++)e.SEGMENT(f,0,c[d].segment),f+=c[d].length;return e.SEGMENT()},get:function(a){var b=[];for(var d=0,e=c.length;d<e;d++)c[d].app===a.toUpperCase()&&b.push(c[d].segment);return b},set:function(a,b){var d=[];typeof b=="string"?d.push(b):d=b;for(var e=ii=0,f=c.length;e<f;e++){c[e].app===a.toUpperCase()&&(c[e].segment=d[ii],c[e].length=d[ii].length,ii++);if(ii>=d.length)break}},purge:function(){c=[],e.init(null)}}}function m(){function g(b,c){var g=a.SHORT(b),h,i,j,k,l,m,n,o,p=[],q={};for(h=0;h<g;h++){n=m=b+12*h+2,j=c[a.SHORT(n)];if(j===d)continue;k=a.SHORT(n+=2),l=a.LONG(n+=2),n+=4,p=[];switch(k){case 1:case 7:l>4&&(n=a.LONG(n)+e.tiffHeader);for(i=0;i<l;i++)p[i]=a.BYTE(n+i);break;case 2:l>4&&(n=a.LONG(n)+e.tiffHeader),q[j]=a.STRING(n,l-1);continue;case 3:l>2&&(n=a.LONG(n)+e.tiffHeader);for(i=0;i<l;i++)p[i]=a.SHORT(n+i*2);break;case 4:l>1&&(n=a.LONG(n)+e.tiffHeader);for(i=0;i<l;i++)p[i]=a.LONG(n+i*4);break;case 5:n=a.LONG(n)+e.tiffHeader;for(i=0;i<l;i++)p[i]=a.LONG(n+i*4)/a.LONG(n+i*4+4);break;case 9:n=a.LONG(n)+e.tiffHeader;for(i=0;i<l;i++)p[i]=a.SLONG(n+i*4);break;case 10:n=a.LONG(n)+e.tiffHeader;for(i=0;i<l;i++)p[i]=a.SLONG(n+i*4)/a.SLONG(n+i*4+4);break;default:continue}o=l==1?p[0]:p,f.hasOwnProperty(j)&&typeof o!="object"?q[j]=f[j][o]:q[j]=o}return q}function h(){var c=d,f=e.tiffHeader;return a.II(a.SHORT(f)==18761),a.SHORT(f+=2)!==42?!1:(e.IFD0=e.tiffHeader+a.LONG(f+=2),c=g(e.IFD0,b.tiff),e.exifIFD="ExifIFDPointer"in c?e.tiffHeader+c.ExifIFDPointer:d,e.gpsIFD="GPSInfoIFDPointer"in c?e.tiffHeader+c.GPSInfoIFDPointer:d,!0)}function j(c,d,f){var g,h,j,k=0;if(typeof d=="string"){var l=b[c.toLowerCase()];for(hex in l)if(l[hex]===d){d=hex;break}}g=e[c.toLowerCase()+"IFD"],h=a.SHORT(g);for(i=0;i<h;i++){j=g+12*i+2;if(a.SHORT(j)==d){k=j+8;break}}return k?(a.LONG(k,f),!0):!1}var a,b,e={},f;return a=new k,b={tiff:{274:"Orientation",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer"},exif:{36864:"ExifVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",36867:"DateTimeOriginal",33434:"ExposureTime",33437:"FNumber",34855:"ISOSpeedRatings",37377:"ShutterSpeedValue",37378:"ApertureValue",37383:"MeteringMode",37384:"LightSource",37385:"Flash",41986:"ExposureMode",41987:"WhiteBalance",41990:"SceneCaptureType",41988:"DigitalZoomRatio",41992:"Contrast",41993:"Saturation",41994:"Sharpness"},gps:{0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude"}},f={ColorSpace:{1:"sRGB",0:"Uncalibrated"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{1:"Daylight",2:"Fliorescent",3:"Tungsten",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 -5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire.",1:"Flash fired.",5:"Strobe return light not detected.",7:"Strobe return light detected.",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},ExposureMode:{0:"Auto exposure",1:"Manual exposure",2:"Auto bracket"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},GPSLatitudeRef:{N:"North latitude",S:"South latitude"},GPSLongitudeRef:{E:"East longitude",W:"West longitude"}},{init:function(b){return e={tiffHeader:10},b===d||!b.length?!1:(a.init(b),a.SHORT(0)===65505&&a.STRING(4,5).toUpperCase()==="EXIF\0"?h():!1)},EXIF:function(){var a;a=g(e.exifIFD,b.exif);if(a.ExifVersion&&c.typeOf(a.ExifVersion)==="array"){for(var d=0,f="";d<a.ExifVersion.length;d++)f+=String.fromCharCode(a.ExifVersion[d]);a.ExifVersion=f}return a},GPS:function(){var a;return a=g(e.gpsIFD,b.gps),a.GPSVersionID&&(a.GPSVersionID=a.GPSVersionID.join(".")),a},setExif:function(a,b){return a!=="PixelXDimension"&&a!=="PixelYDimension"?!1:j("exif",a,b)},getBinary:function(){return a.SEGMENT()}}}var e={},f;c.runtimes.Html5=c.addRuntime("html5",{getFeatures:function(){var d,e,g,h,i,j;return e=g=i=j=!1,a.XMLHttpRequest&&(d=new XMLHttpRequest,g=!!d.upload,e=!!d.sendAsBinary||!!d.upload),e&&(h=!!(d.sendAsBinary||a.Uint8Array&&a.ArrayBuffer),i=!(!File||!File.prototype.getAsDataURL&&!a.FileReader||!h),j=!!File&&!!(File.prototype.mozSlice||File.prototype.webkitSlice||File.prototype.slice)),f=c.ua.safari&&c.ua.windows,{html5:e,dragdrop:function(){var a=b.createElement("div");return"draggable"in a||"ondragstart"in a&&"ondrop"in a}(),jpgresize:i,pngresize:i,multipart:i||!!a.FileReader||!!a.FormData,canSendBinary:h,cantSendBlobInFormData:!!(c.ua.gecko&&a.FormData&&a.FileReader&&!FileReader.prototype.readAsArrayBuffer),progress:g,chunks:j,multi_selection:!c.ua.safari||!c.ua.windows,triggerDialog:c.ua.gecko&&a.FormData||c.ua.webkit}},init:function(d,g){function l(a){var b,f,g=[],h,i={};for(f=0;f<a.length;f++){b=a[f];if(i[b.name])continue;i[b.name]=!0,h=c.guid(),e[h]=b,g.push(new c.File(h,b.fileName||b.name,b.fileSize||b.size))}g.length&&d.trigger("FilesAdded",g)}var i,k;i=this.getFeatures();if(!i.html5){g({success:!1});return}d.bind("Init",function(a){var e,f,g=[],h,i,j=a.settings.filters,k,m,n=b.body,o;e=b.createElement("div"),e.id=a.id+"_html5_container",c.extend(e.style,{position:"absolute",background:d.settings.shim_bgcolor||"transparent",width:"100px",height:"100px",overflow:"hidden",zIndex:99999,opacity:d.settings.shim_bgcolor?"":0}),e.className="plupload html5",d.settings.container&&(n=b.getElementById(d.settings.container),c.getStyle(n,"position")==="static"&&(n.style.position="relative")),n.appendChild(e);a:for(h=0;h<j.length;h++){k=j[h].extensions.split(/,/);for(i=0;i<k.length;i++){if(k[i]==="*"){g=[];break a}m=c.mimeTypes[k[i]],m&&c.inArray(m,g)===-1&&g.push(m)}}e.innerHTML='<input id="'+d.id+'_html5" '+' style="font-size:999px"'+' type="file" accept="'+g.join(",")+'" '+(d.settings.multi_selection&&d.features.multi_selection?'multiple="multiple"':"")+" />",e.scrollTop=100,o=b.getElementById(d.id+"_html5"),a.features.triggerDialog?c.extend(o.style,{position:"absolute",width:"100%",height:"100%"}):c.extend(o.style,{cssFloat:"right",styleFloat:"right"}),o.onchange=function(){l(this.files),this.value=""},f=b.getElementById(a.settings.browse_button);if(f){var p=a.settings.browse_button_hover,q=a.settings.browse_button_active,r=a.features.triggerDialog?f:e;p&&(c.addEvent(r,"mouseover",function(){c.addClass(f,p)},a.id),c.addEvent(r,"mouseout",function(){c.removeClass(f,p)},a.id)),q&&(c.addEvent(r,"mousedown",function(){c.addClass(f,q)},a.id),c.addEvent(b.body,"mouseup",function(){c.removeClass(f,q)},a.id)),a.features.triggerDialog&&c.addEvent(f,"click",function(c){var d=b.getElementById(a.id+"_html5");d&&!d.disabled&&d.click(),c.preventDefault()},a.id)}}),d.bind("PostInit",function(){var a=b.getElementById(d.settings.drop_element);if(a){if(f){c.addEvent(a,"dragenter",function(e){var f,g,h;f=b.getElementById(d.id+"_drop"),f||(f=b.createElement("input"),f.setAttribute("type","file"),f.setAttribute("id",d.id+"_drop"),f.setAttribute("multiple","multiple"),c.addEvent(f,"change",function(){l(this.files),c.removeEvent(f,"change",d.id),f.parentNode.removeChild(f)},d.id),a.appendChild(f)),g=c.getPos(a,b.getElementById(d.settings.container)),h=c.getSize(a),c.getStyle(a,"position")==="static"&&c.extend(a.style,{position:"relative"}),c.extend(f.style,{position:"absolute",display:"block",top:0,left:0,width:h.w+"px",height:h.h+"px",opacity:0})},d.id);return}c.addEvent(a,"dragover",function(a){a.preventDefault()},d.id),c.addEvent(a,"drop",function(a){var b=a.dataTransfer;b&&b.files&&l(b.files),a.preventDefault()},d.id)}}),d.bind("Refresh",function(a){var e,f,g,h,i;e=b.getElementById(d.settings.browse_button),e&&(f=c.getPos(e,b.getElementById(a.settings.container)),g=c.getSize(e),h=b.getElementById(d.id+"_html5_container"),c.extend(h.style,{top:f.y+"px",left:f.x+"px",width:g.w+"px",height:g.h+"px"}),d.features.triggerDialog&&(c.getStyle(e,"position")==="static"&&c.extend(e.style,{position:"relative"}),i=parseInt(c.getStyle(e,"zIndex"),10),isNaN(i)&&(i=0),c.extend(e.style,{zIndex:i}),c.extend(h.style,{zIndex:i-1})))}),d.bind("DisableBrowse",function(a,c){var d=b.getElementById(a.id+"_html5");d&&(d.disabled=c)}),d.bind("CancelUpload",function(){k&&k.abort&&k.abort()}),d.bind("UploadFile",function(b,d){function m(a,b,c){var d;if(!File.prototype.slice)return(d=File.prototype.webkitSlice||File.prototype.mozSlice)?d.call(a,b,c):null;try{return a.slice(),a.slice(b,c)}catch(e){return a.slice(b,c-b)}}function n(e){function l(){function v(e){var f=0,j="----pluploadboundary"+c.guid(),m,o="--",v="\r\n",w="";k=new XMLHttpRequest,k.upload&&(k.upload.onprogress=function(a){d.loaded=Math.min(d.size,h+a.loaded-f),b.trigger("UploadProgress",d)}),k.onreadystatechange=function(){var a,f;if(k.readyState==4&&b.state!==c.STOPPED){try{a=k.status}catch(i){a=0}if(a>=400)b.trigger("Error",{code:c.HTTP_ERROR,message:c.translate("HTTP Error."),file:d,status:a});else{if(p){f={chunk:g,chunks:p,response:k.responseText,status:a},b.trigger("ChunkUploaded",d,f),h+=s;if(f.cancelled){d.status=c.FAILED;return}d.loaded=Math.min(d.size,(g+1)*r)}else d.loaded=d.size;b.trigger("UploadProgress",d),e=n=m=w=null,!p||++g>=p?(d.status=c.DONE,b.trigger("FileUploaded",d,{response:k.responseText,status:a})):l()}}};if(b.settings.multipart&&i.multipart){q.name=d.target_name||d.name,k.open("post",u,!0),c.each(b.settings.headers,function(a,b){k.setRequestHeader(b,a)});if(typeof e!="string"&&!!a.FormData){m=new FormData,c.each(c.extend(q,b.settings.multipart_params),function(a,b){m.append(b,a)}),m.append(b.settings.file_data_name,e),k.send(m);return}if(typeof e=="string"){k.setRequestHeader("Content-Type","multipart/form-data; boundary="+j),c.each(c.extend(q,b.settings.multipart_params),function(a,b){w+=o+j+v+'Content-Disposition: form-data; name="'+b+'"'+v+v,w+=unescape(encodeURIComponent(a))+v}),t=c.mimeTypes[d.name.replace(/^.+\.([^.]+)/,"$1").toLowerCase()]||"application/octet-stream",w+=o+j+v+'Content-Disposition: form-data; name="'+b.settings.file_data_name+'"; filename="'+unescape(encodeURIComponent(d.name))+'"'+v+"Content-Type: "+t+v+v+e+v+o+j+o+v,f=w.length-e.length,e=w;if(k.sendAsBinary)k.sendAsBinary(e);else if(i.canSendBinary){var x=new Uint8Array(e.length);for(var y=0;y<e.length;y++)x[y]=e.charCodeAt(y)&255;k.send(x.buffer)}return}}u=c.buildUrl(b.settings.url,c.extend(q,b.settings.multipart_params)),k.open("post",u,!0),k.setRequestHeader("Content-Type","application/octet-stream"),c.each(b.settings.headers,function(a,b){k.setRequestHeader(b,a)}),k.send(e)}var n,o,p,q,r,s,t,u=b.settings.url;if(d.status==c.DONE||d.status==c.FAILED||b.state==c.STOPPED)return;q={name:d.target_name||d.name},f.chunk_size&&d.size>f.chunk_size&&(i.chunks||typeof e=="string")?(r=f.chunk_size,p=Math.ceil(d.size/r),s=Math.min(r,d.size-g*r),typeof e=="string"?n=e.substring(g*r,g*r+s):n=m(e,g*r,g*r+s),q.chunk=g,q.chunks=p):(s=d.size,n=e),b.settings.multipart&&i.multipart&&typeof n!="string"&&j&&i.cantSendBlobInFormData&&i.chunks&&b.settings.chunk_size?(j.onload=function(){v(j.result)},j.readAsBinaryString(n)):v(n)}var g=0,h=0
,j="FileReader"in a?new FileReader:null;l()}var f=b.settings,g,l;g=e[d.id],i.jpgresize&&b.settings.resize&&/\.(png|jpg|jpeg)$/i.test(d.name)?j.call(b,d,b.settings.resize,/\.png$/i.test(d.name)?"image/png":"image/jpeg",function(a){a.success?(d.size=a.data.length,n(a.data)):i.chunks?n(g):h(g,n)}):!i.chunks&&i.jpgresize?h(g,n):n(g)}),d.bind("Destroy",function(a){var d,e,f=b.body,g={inputContainer:a.id+"_html5_container",inputFile:a.id+"_html5",browseButton:a.settings.browse_button,dropElm:a.settings.drop_element};for(d in g)e=b.getElementById(g[d]),e&&c.removeAllEvents(e,a.id);c.removeAllEvents(b.body,a.id),a.settings.container&&(f=b.getElementById(a.settings.container)),f.removeChild(b.getElementById(g.inputContainer))}),g({success:!0})}})}(window,document,plupload);